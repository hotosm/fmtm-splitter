
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A program for splitting a large AOI into smaller tasks.">
      
      
      
        <link rel="canonical" href="https://www.hotosm.org/splitting-algorithm/">
      
      
        <link rel="prev" href="../api/">
      
      
        <link rel="next" href="../testing-via-ui/">
      
      
      <link rel="icon" href="../images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.42">
    
    
      
        <title>Splitting Algorithm - fmtm-splitter</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../css/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#the-aoi-splitting-algorithm" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="fmtm-splitter" class="md-header__button md-logo" aria-label="fmtm-splitter" data-md-component="logo">
      
  <img src="../images/hot_logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            fmtm-splitter
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Splitting Algorithm
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/hotosm/fmtm-splitter/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    hotosm/fmtm-splitter
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="fmtm-splitter" class="md-nav__button md-logo" aria-label="fmtm-splitter" data-md-component="logo">
      
  <img src="../images/hot_logo.png" alt="logo">

    </a>
    fmtm-splitter
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/hotosm/fmtm-splitter/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    hotosm/fmtm-splitter
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Get Started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Get Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../LICENSE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    License
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../CHANGELOG/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Changelog
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://docs.hotosm.org/code-of-conduct" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Code of Conduct
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://docs.hotosm.org/dev-guide/repo-management/version-control/#creating-releases" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Versioning
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../usage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Usage
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Splitting Algorithm
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Splitting Algorithm
  </span>
  

      </a>
      
        

  

<nav class="md-nav md-nav--secondary" aria-label="Page contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Page contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#how-it-works" class="md-nav__link">
    <span class="md-ellipsis">
      How It Works
    </span>
  </a>
  
    <nav class="md-nav" aria-label="How It Works">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-split-aoi-by-linear-features" class="md-nav__link">
    <span class="md-ellipsis">
      1. Split AOI By Linear Features
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-group-buildings-by-polygon" class="md-nav__link">
    <span class="md-ellipsis">
      2. Group Buildings By Polygon
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-cluster-the-buildings" class="md-nav__link">
    <span class="md-ellipsis">
      3. Cluster The Buildings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-enclose-the-buildings" class="md-nav__link">
    <span class="md-ellipsis">
      4. Enclose The Buildings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-filling-the-negative-space" class="md-nav__link">
    <span class="md-ellipsis">
      5. Filling The Negative Space
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-alignment-of-task-areas-optional" class="md-nav__link">
    <span class="md-ellipsis">
      6. Alignment Of Task Areas (Optional)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#requirements-future-plans" class="md-nav__link">
    <span class="md-ellipsis">
      Requirements &amp; Future Plans
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Requirements & Future Plans">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#input-datasets" class="md-nav__link">
    <span class="md-ellipsis">
      Input Datasets
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Input Datasets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aoi" class="md-nav__link">
    <span class="md-ellipsis">
      AOI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#splitting-lines-linear-features" class="md-nav__link">
    <span class="md-ellipsis">
      Splitting Lines (Linear Features)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#map-features" class="md-nav__link">
    <span class="md-ellipsis">
      Map Features
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#output-datasets" class="md-nav__link">
    <span class="md-ellipsis">
      Output Datasets
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extra-work" class="md-nav__link">
    <span class="md-ellipsis">
      Extra Work
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-the-workflow-in-qgis" class="md-nav__link">
    <span class="md-ellipsis">
      Testing The Workflow In QGIS
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Testing The Workflow In QGIS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#running-bleeding-edge-postgis-locally" class="md-nav__link">
    <span class="md-ellipsis">
      Running Bleeding-Edge PostGIS Locally
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#importing-osm-data" class="md-nav__link">
    <span class="md-ellipsis">
      Importing OSM Data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qgis-db-manager" class="md-nav__link">
    <span class="md-ellipsis">
      QGIS DB Manager
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../testing-via-ui/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Testing via UI
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  

<nav class="md-nav md-nav--secondary" aria-label="Page contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Page contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#how-it-works" class="md-nav__link">
    <span class="md-ellipsis">
      How It Works
    </span>
  </a>
  
    <nav class="md-nav" aria-label="How It Works">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-split-aoi-by-linear-features" class="md-nav__link">
    <span class="md-ellipsis">
      1. Split AOI By Linear Features
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-group-buildings-by-polygon" class="md-nav__link">
    <span class="md-ellipsis">
      2. Group Buildings By Polygon
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-cluster-the-buildings" class="md-nav__link">
    <span class="md-ellipsis">
      3. Cluster The Buildings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-enclose-the-buildings" class="md-nav__link">
    <span class="md-ellipsis">
      4. Enclose The Buildings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-filling-the-negative-space" class="md-nav__link">
    <span class="md-ellipsis">
      5. Filling The Negative Space
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-alignment-of-task-areas-optional" class="md-nav__link">
    <span class="md-ellipsis">
      6. Alignment Of Task Areas (Optional)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#requirements-future-plans" class="md-nav__link">
    <span class="md-ellipsis">
      Requirements &amp; Future Plans
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Requirements & Future Plans">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#input-datasets" class="md-nav__link">
    <span class="md-ellipsis">
      Input Datasets
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Input Datasets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aoi" class="md-nav__link">
    <span class="md-ellipsis">
      AOI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#splitting-lines-linear-features" class="md-nav__link">
    <span class="md-ellipsis">
      Splitting Lines (Linear Features)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#map-features" class="md-nav__link">
    <span class="md-ellipsis">
      Map Features
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#output-datasets" class="md-nav__link">
    <span class="md-ellipsis">
      Output Datasets
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extra-work" class="md-nav__link">
    <span class="md-ellipsis">
      Extra Work
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-the-workflow-in-qgis" class="md-nav__link">
    <span class="md-ellipsis">
      Testing The Workflow In QGIS
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Testing The Workflow In QGIS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#running-bleeding-edge-postgis-locally" class="md-nav__link">
    <span class="md-ellipsis">
      Running Bleeding-Edge PostGIS Locally
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#importing-osm-data" class="md-nav__link">
    <span class="md-ellipsis">
      Importing OSM Data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qgis-db-manager" class="md-nav__link">
    <span class="md-ellipsis">
      QGIS DB Manager
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="the-aoi-splitting-algorithm">The AOI Splitting Algorithm<a class="headerlink" href="#the-aoi-splitting-algorithm" title="Permanent link">&para;</a></h1>
<p>For now (as of 19-12-2024), this algorithm is entirely focused on splitting
polygon features such as buildings.</p>
<h2 id="how-it-works">How It Works<a class="headerlink" href="#how-it-works" title="Permanent link">&para;</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<div class="highlight"><pre><span></span><code>For ease of understanding, I will replace the word &#39;feature&#39;
with &#39;building&#39; in the following description. But the word
&#39;building&#39; could in theory be substituted by any feature type.
</code></pre></div>
</div>
<h3 id="1-split-aoi-by-linear-features">1. Split AOI By Linear Features<a class="headerlink" href="#1-split-aoi-by-linear-features" title="Permanent link">&para;</a></h3>
<ul>
<li>First we divide up the AOI into polygons, based on the provided
  bisecting features such as roads, rivers, and railways.</li>
<li>To do this we:<ul>
<li>Polygonize the linear features.</li>
<li>Centroid the features to make sure they only get counted in one
      splitpolygon.</li>
<li>Clip by the AOI polygon.</li>
</ul>
</li>
<li>We get the database table <code>polygonsnocount</code>.</li>
<li>Polygons with zero or too few features are merged into neighbours.</li>
</ul>
<p><strong>Output</strong>: Polygons covering the AOI area.</p>
<p>[image here]</p>
<h3 id="2-group-buildings-by-polygon">2. Group Buildings By Polygon<a class="headerlink" href="#2-group-buildings-by-polygon" title="Permanent link">&para;</a></h3>
<ul>
<li>Next we take our buildings, insert into db table <code>buildings</code>, then find
  the polygon each building centroid is located within.</li>
<li>Now we create the next table <code>splitpolygons</code> where we add the count of
  the total number of buildings within each polygon, plus the polygon
  area.</li>
</ul>
<p><strong>Output</strong>: Building dataset tagged with their containing polygon's ID.</p>
<p>[image here]</p>
<h3 id="3-cluster-the-buildings">3. Cluster The Buildings<a class="headerlink" href="#3-cluster-the-buildings" title="Permanent link">&para;</a></h3>
<ul>
<li>For each polygon containing buildings, we pass through a K-Means clustering
  algorithm, to output X number of clusters.</li>
<li>X is calculated as:<div class="highlight"><pre><span></span><code>  ```bash
  (T / A) + 1
  T - Total building count
  A - Average number of buildings desired per cluster
  ```
</code></pre></div>
</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Info</p>
<div class="highlight"><pre><span></span><code>K-Means will group buildings based on their spatial proximity, ideally
grouping together buildings that are close together (reducing walking
distance for mappers in the field).
</code></pre></div>
</div>
<ul>
<li>We create a table <code>clusteredbuildings</code> where we have the original buildings,
  plus their assigned cluster ID from K-Means.<ul>
<li>The field <code>clusteruid</code> is a composite of <code>polygonid '-' clusterid</code>.</li>
<li>The <code>clusterid</code> is specific to the containing polygon (starting from 0).</li>
<li>For example polygon <code>377</code> will have IDs <code>377-0</code>, <code>377-1</code>, <code>377-2</code>.</li>
</ul>
</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<div class="highlight"><pre><span></span><code>Using K-Means, we should be aware:

- Edge cases: sparse areas may create clusters with few buildings,
and dense areas could result in many overlapping clusters.
- Trial and error: the clustering quality depends on fine-tuning the
average number of buildings per cluster.
</code></pre></div>
</div>
<p><strong>Output</strong>: Building dataset tagged with their containing polygon's ID,
plus a cluster ID specific to the polygon.</p>
<p>[image here]</p>
<h3 id="4-enclose-the-buildings">4. Enclose The Buildings<a class="headerlink" href="#4-enclose-the-buildings" title="Permanent link">&para;</a></h3>
<div class="admonition info">
<p class="admonition-title">Info</p>
<div class="highlight"><pre><span></span><code>We previously used a Voronoi based approach:

1. Densify the buildings to reduce the impact of long edges
(maximum edge 0.00004 degrees).
2. Dump the building polygons into points.
3. Create a Voronoi diagram (a technique to divide up the points within
an area into polygons, where each final polygon contains the closest
&#39;neighbour&#39; points from the clusters in the previous step).
This approach had some flaws, so we have attempted other approaches, below.
</code></pre></div>
</div>
<ul>
<li>Divide up each cluster into polygons using convex hulls.</li>
<li>Here we essentially form small 'islands' of buildings.</li>
<li>Fixing polygon overlaps:
      - We may have a few polygon overlaps, where a building could fall between
 two polygon areas.
      - To solve this, we find all of the overlapping 'shards', and subtract
   from the polygon area.
      - We then union all de-overlapped hulls with their buildings (the
   de-overlapping will have left some feature polygons partially and
   maybe wholly outside of their home polygons, this should restore
   them without creating new overlaps unless the features themselves
   are overlapping, in which case there isn't a great solution).</li>
</ul>
<p><strong>Output</strong>: Task polygons that don't overlap and fully enclose all features,
that don't have jagged / complex edges.</p>
<p>[image here]</p>
<h3 id="5-filling-the-negative-space">5. Filling The Negative Space<a class="headerlink" href="#5-filling-the-negative-space" title="Permanent link">&para;</a></h3>
<ul>
<li>Now we have our 'islands' of buildings, this would be fine if we knew
  for certain that they contained every possible building in the field.</li>
<li>However, in the real world, we may have missed some buildings, so the
  task areas should be expanded out to cover the entire AOI footprint.</li>
<li>We can create a 'negative' space multipolygon by subtracting the hulls
  from the AOI.</li>
<li>The 'negative' space multipolygon can be filled using the
  'straight skeleton' algorithm:
      - This is essentially a Voronoi algorithm, but for polygons
   instead of points! (not exactly, but it's an analogy)
      - The algorithm will work on the edges and corners of the 'hull'
   polygons, to generate bounding 'filler' polygons between them.<ul>
<li>It will perfectly bisect between buildings or polygon areas,
 instead of creating wavy / zig-zag boundaries.</li>
</ul>
</li>
<li>Finally, we identify the edge-sharing neighbor hull of each element
  of the polygonized skeleton, dissolve them into those neighbors.</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Info</p>
<div class="highlight"><pre><span></span><code>- Voronoi diagrams divide space based on distances to points or
polygons, creating regions with perpendicular bisectors.
- Straight skeletons shrink polygon edges inward at equal speed
to create a network of lines (skeleton) and subdivided polygons.
It’s more about preserving the shape of polygons rather than
distance-based partitioning.
</code></pre></div>
</div>
<p><strong>Output</strong>: Split task area polygons.</p>
<blockquote>
<p>The original buildings, including tag data, can be superimposed on
to these task polygons, to assign them to each task area.</p>
</blockquote>
<p>[image here]</p>
<h3 id="6-alignment-of-task-areas-optional">6. Alignment Of Task Areas (Optional)<a class="headerlink" href="#6-alignment-of-task-areas-optional" title="Permanent link">&para;</a></h3>
<ul>
<li>The final problem here is aligning the polygon areas back with the
  linear features, as they may have shifted slightly during all the
  processing!
      - For example the task boundaries should ideally align in the
   center of a highway polylin.
      - Using a window function, we can essentially run the same steps
   as above, but for each specific cluster area, instead of the
   whole AOI, reducing the drift from the linear features.</li>
</ul>
<p><strong>Output</strong>: Split task area polygons, better aligned to linear features.</p>
<p>[image here]</p>
<h2 id="requirements-future-plans">Requirements &amp; Future Plans<a class="headerlink" href="#requirements-future-plans" title="Permanent link">&para;</a></h2>
<p>Input from Ivan Gayton @ 18/12/2024</p>
<h3 id="input-datasets">Input Datasets<a class="headerlink" href="#input-datasets" title="Permanent link">&para;</a></h3>
<h4 id="aoi">AOI<a class="headerlink" href="#aoi" title="Permanent link">&para;</a></h4>
<ul>
<li>Do some GeoJSON cleanup, CRS checking, and normalise to a specific format.</li>
<li>Ideally we just have a Polygon GeoJSON.</li>
</ul>
<h4 id="splitting-lines-linear-features">Splitting Lines (Linear Features)<a class="headerlink" href="#splitting-lines-linear-features" title="Permanent link">&para;</a></h4>
<ul>
<li>Allow polyline input from sources other than OSM.</li>
<li>From OSM:
      - Polylines: default all, but user configurable (major vs minor highways, etc).<ul>
<li>Polygons: filter tags for traffic circles, water bodies, etc, then split into
  polylines.</li>
</ul>
</li>
</ul>
<p>In both cases, we likely only need the geometry, no tags.</p>
<h4 id="map-features">Map Features<a class="headerlink" href="#map-features" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Points</strong>:<ul>
<li>Geometries, plus tags.</li>
<li>Centroids of polygons.</li>
<li>Midpoint of polylines.</li>
</ul>
</li>
</ul>
<ul>
<li><strong>Polylines</strong>:<ul>
<li>Geometries, plus tags.</li>
<li>Convert relevant polygons such as traffic circles / water bodies into
      polylines.</li>
<li>Split roads at all intersections, so that every polyline constitutes an
      edge in a graph.</li>
</ul>
</li>
</ul>
<ul>
<li><strong>Polygons</strong>:<ul>
<li>Geometries, plus tags.</li>
<li>Convert multipolygons (like OSM buildings with holes) into simple polygons for
  the purpose of splitting (maybe we want the multipolygons to send to the data
  collection app later, but for splitting we definitely don't want holes).</li>
<li>Do some checking/cleaning for invalid geometries.</li>
</ul>
</li>
</ul>
<h3 id="output-datasets">Output Datasets<a class="headerlink" href="#output-datasets" title="Permanent link">&para;</a></h3>
<p>We need the following datasets of geometries, but probably not any tags
associated:</p>
<div class="highlight"><pre><span></span><code>- AOI
- Splitlines
- Features
</code></pre></div>
<p>The original features should probably be retained for later use in the
actual data collection (e.g. conflation), but for splitting purposes we
don't need all the tags and fields, and we definitely don't want any
complex geometry.</p>
<h3 id="extra-work">Extra Work<a class="headerlink" href="#extra-work" title="Permanent link">&para;</a></h3>
<p>Large task polygons:</p>
<ul>
<li>We might need to check for task polygons that are too big.</li>
<li>If there are regions with sparse features, they might end
  up with giant task polygons, in which case we might want to
  sub-split them (maybe into squares).</li>
</ul>
<h2 id="testing-the-workflow-in-qgis">Testing The Workflow In QGIS<a class="headerlink" href="#testing-the-workflow-in-qgis" title="Permanent link">&para;</a></h2>
<h3 id="running-bleeding-edge-postgis-locally">Running Bleeding-Edge PostGIS Locally<a class="headerlink" href="#running-bleeding-edge-postgis-locally" title="Permanent link">&para;</a></h3>
<p>First you may need to set up a local Postgres database, including the latest
bleeding-edge version of PostGIS and SFCGAL.</p>
<p>The easiest way is via Docker (single command):</p>
<div class="highlight"><pre><span></span><code>    ```bash
    docker run --name aoi-splitting-db --detach \
      -p 5432:5432 -v ./db_data:/var/lib/postgresql/data/  \
      -e POSTGRES_USER=hotosm \
      -e POSTGRES_PASSWORD=hotosm \
      -e POSTGRES_DB=splitter \
      docker.io/postgis/postgis:17-master \
    &amp;&amp; sleep 5 \
    &amp;&amp; docker exec aoi-splitting-db psql -d splitter -U hotosm -c \
      &#39;CREATE EXTENSION IF NOT EXISTS postgis_sfcgal WITH SCHEMA public;&#39;
    ```
</code></pre></div>
<p>The instance will be available:</p>
<div class="highlight"><pre><span></span><code>- Host: `localhost`
- Port: `5432`
- Database: `splitter`
- User `hotosm`
- Password `hotosm`
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<div class="highlight"><pre><span></span><code>Changing the port on the left side in the command `8888:5432`,
will make Postgres available on a different port for you.
</code></pre></div>
</div>
<h3 id="importing-osm-data">Importing OSM Data<a class="headerlink" href="#importing-osm-data" title="Permanent link">&para;</a></h3>
<p>Get the raw-data-api Lua OSM import script:</p>
<div class="highlight"><pre><span></span><code>    ```bash
    curl -LO https://raw.githubusercontent.com/hotosm/osm-rawdata/refs/heads/main/osm_rawdata/import/raw.lua
    ```
</code></pre></div>
<p>Download some data from GeoFabrik:</p>
<div class="highlight"><pre><span></span><code>     &lt;https://download.geofabrik.de&gt;
</code></pre></div>
<p>Import into Postgres:</p>
<div class="highlight"><pre><span></span><code>    ```bash
    osm2pgsql --create -H localhost -U hotosm -P 5432 -d splitter \
      -W --extra-attributes --output=flex --style ./raw.lua \
      /your-geofabrik-file.osm.pbf
    ```
</code></pre></div>
<h3 id="qgis-db-manager">QGIS DB Manager<a class="headerlink" href="#qgis-db-manager" title="Permanent link">&para;</a></h3>
<ul>
<li>Install the QGIS DB Manager plugin.</li>
<li>View the geoms you just added.</li>
<li>Run each step of the splitting algorithm SQL sequentially.</li>
<li>View the intermediary tables and geometries created.</li>
<li>More detailed instructions to come!</li>
</ul>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">December 19, 2024</span>
  </span>

    
    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/hotosm/" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/hotosm" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.hotosm.org" target="_blank" rel="noopener" title="www.hotosm.org" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M352 256c0 22.2-1.2 43.6-3.3 64H163.4c-2.2-20.4-3.3-41.8-3.3-64s1.2-43.6 3.3-64h185.3c2.2 20.4 3.3 41.8 3.3 64m28.8-64h123.1c5.3 20.5 8.1 41.9 8.1 64s-2.8 43.5-8.1 64H380.8c2.1-20.6 3.2-42 3.2-64s-1.1-43.4-3.2-64m112.6-32H376.7c-10-63.9-29.8-117.4-55.3-151.6 78.3 20.7 142 77.5 171.9 151.6zm-149.1 0H167.7c6.1-36.4 15.5-68.6 27-94.7 10.5-23.6 22.2-40.7 33.5-51.5C239.4 3.2 248.7 0 256 0s16.6 3.2 27.8 13.8c11.3 10.8 23 27.9 33.5 51.5 11.6 26 20.9 58.2 27 94.7m-209 0H18.6c30-74.1 93.6-130.9 172-151.6-25.5 34.2-45.3 87.7-55.3 151.6M8.1 192h123.1c-2.1 20.6-3.2 42-3.2 64s1.1 43.4 3.2 64H8.1C2.8 299.5 0 278.1 0 256s2.8-43.5 8.1-64m186.6 254.6c-11.6-26-20.9-58.2-27-94.6h176.6c-6.1 36.4-15.5 68.6-27 94.6-10.5 23.6-22.2 40.7-33.5 51.5-11.2 10.7-20.5 13.9-27.8 13.9s-16.6-3.2-27.8-13.8c-11.3-10.8-23-27.9-33.5-51.5zM135.3 352c10 63.9 29.8 117.4 55.3 151.6-78.4-20.7-142-77.5-172-151.6zm358.1 0c-30 74.1-93.6 130.9-171.9 151.6 25.5-34.2 45.2-87.7 55.3-151.6h116.7z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  </body>
</html>